Guacamole will provide users with a Graphical User Interface to interact with Kali Linux machine.

We will begin by hardening the Kali Linux machine:
Install the following firewall service:
  kali@kali:~$ sudo apt-get install ufw fail2ban
Configure ufw to allow port 22 for SSH connections and port 55555 for Guacamole connections
  kali@kali:~$ sudo ufw allow 22
  kali@kali:~$ sudo ufw allow 55555

Guacamole Install:
Download Guacamole prerequisites
  kali@kali:~$ sudo apt-get install build-essential htop libcairo2-dev libjpeg-dev libpng-dev libossp-uuid-dev tomcat9 freerdp2-dev libpango1.0-dev libssh2-1-     dev libtelnet-dev libvncserver-dev libpulse-dev libssl-dev libvorbis-dev
Edit the /etc/tomcat9/server.xml file and change the Connector port to 55555
  <Connector port="55555" protocol="HTTP/1.1"
Install the RDP service:
  kali@kali:~$ sudo apt install xrdp
Edit the following file /etc/X11/Xwrapper.config and change the value of allowed_users to anybody
  allowed_users=anybody
Set xrdp services to start automatically and enable the service
  kali@kali:~$ sudo systemctl enable xrdp-sesman.service
  kali@kali:~$ sudo service xrdp start
  kali@kali:~$ sudo service xrdp-sesman start
Download Guacamole:
  kali@kali:~$ wget http://mirrors.estointernet.in/apache/guacamole/1.0.0/source/guacamole-server-1.0.0.tar.gz
  kali@kali:~$ wget http://mirrors.estointernet.in/apache/guacamole/1.0.0/binary/guacamole-1.0.0.war
Build and install Guacamole:
  kali@kali:~$ CFLAGS="-Wno-error" ./configure --with-init-dir=/etc/init.d
  kali@kali:~$ make -j4
  kali@kali:~$ sudo make install
  kali@kali:~$ sudo ldconfig
  kali@kali:~$ sudo update-rc.d guacd defaults
Create a guacamole.properties file in /etc/guacamole
  #Hostname and Port of Guacamole Proxy
  guacad-hostname: localhost
  guacd-port:      4822
Create a user-mapping.xml file containg the following:
  <user-mapping>
        <authorize username="kali" password="kali">
                <connection name="RDP Connection"> <protocol>rdp</protocol> <param name="hostname">localhost</param> <param name="port">3389</param> </connection>
                <connection name="SSH Connection"> <protocol>ssh</protocol> <param name="hostname">localhost</param> <param name="port">22</param> </connection>
        </authorize>
  </user-mapping>
